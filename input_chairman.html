<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>è‘£äº‹é•·å°ˆç”¨ç¥ç¦</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
  <style>
    :root {
      --bg-color: #050914;
      --kgi-orange: #f39800;
      --kgi-blue: #0056b3;
      --vip-gold: #ffd700;
      --text-color: #fff;
    }

    body {
      margin: 0;
      padding: 20px;
      background: radial-gradient(circle at top, #12284a 0%, #050914 60%, #000000 100%);
      color: var(--text-color);
      font-family: "Microsoft JhengHei", sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      box-sizing: border-box;
    }

    h2 {
      text-align: center;
      color: var(--vip-gold);
      margin-bottom: 20px;
      font-size: 1.6rem;
      letter-spacing: 4px;
    }

    .subtitle {
      text-align: center;
      color: #ccc;
      margin-bottom: 24px;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .card {
      background: rgba(0, 0, 0, 0.55);
      border-radius: 16px;
      border: 1px solid rgba(255, 215, 0, 0.6);
      box-shadow: 0 0 25px rgba(255, 215, 0, 0.4);
      padding: 20px 18px 24px;
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      box-sizing: border-box;
    }

    .input-group {
      margin-bottom: 18px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: #ddd;
      font-size: 0.95rem;
    }

    input, textarea {
      width: 100%;
      padding: 12px;
      background: #101b33;
      border: 1px solid #444;
      color: white;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 1.02rem;
      resize: vertical;
    }

    textarea {
      min-height: 100px;
      max-height: 200px;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: var(--vip-gold);
      background: #182440;
    }

    .hint {
      font-size: 0.8rem;
      color: #aaa;
      margin-top: 4px;
      text-align: right;
    }

    button {
      width: 100%;
      padding: 15px;
      margin-top: 10px;
      border: none;
      border-radius: 999px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      background: linear-gradient(90deg, var(--vip-gold), var(--kgi-orange));
      color: #000;
      box-shadow: 0 4px 18px rgba(255, 215, 0, 0.6);
      transition: transform 0.1s, box-shadow 0.1s;
    }

    button:active {
      transform: scale(0.98);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.7);
    }

    button:disabled {
      background: #555;
      color: #ccc;
      box-shadow: none;
      cursor: not-allowed;
    }

    .status {
      text-align: center;
      margin-top: 15px;
      font-size: 0.9rem;
      color: #bbb;
    }

    .success-msg {
      display: none;
      text-align: center;
      margin-top: 18px;
      padding: 12px;
      background: rgba(0, 255, 0, 0.08);
      border: 1px solid #00ff00;
      border-radius: 10px;
      color: #9cff9c;
      line-height: 1.5;
      font-size: 0.95rem;
    }

    .warning-msg {
      display: none;
      text-align: center;
      margin-top: 12px;
      padding: 10px;
      background: rgba(255, 165, 0, 0.08);
      border: 1px solid rgba(255, 165, 0, 0.8);
      border-radius: 10px;
      color: #ffdd99;
      font-size: 0.9rem;
    }
  </style>
</head>

<body>
  <h2>è‘£äº‹é•·å°ˆç”¨ç¥ç¦</h2>
  <div class="subtitle">
    é€™è£¡è¼¸å…¥çš„å…§å®¹å°‡æ–¼å¤§è¢å¹•ä¸Šé‡é»å‘ˆç¾<br/>
    å»ºè­°ä¸€å¥åˆ°æ•¸å¥è©±ï¼Œçµ±æ•´å°å…¨é«”åŒä»çš„æœŸè¨±èˆ‡å‹‰å‹µ
  </div>

  <div class="card">
    <div class="input-group">
      <label for="name">é¡¯ç¤ºåç¨±</label>
      <input type="text" id="name" value="è‘£äº‹é•·" />
      <div class="hint">å°‡é¡¯ç¤ºæ–¼å¤§è¢å¹•ä¸Šï¼Œä¾‹å¦‚ï¼šè‘£äº‹é•·ã€è‘£äº‹é•· XXX</div>
    </div>

    <div class="input-group">
      <label for="msg">ç¥ç¦å…§å®¹ï¼ˆå»ºè­° 80 å­—å…§ï¼‰</label>
      <textarea id="msg" maxlength="120"
        placeholder="ä¾‹å¦‚ï¼šæ„Ÿè¬å„ä½å¤¥ä¼´ä¸€åŒèšå‹¢æˆ ONEï¼Œæœªä¾†æˆ‘å€‘å°‡åœ¨å‡±åŸºé‡‘æ§çš„æ”¯æŒä¸‹ï¼ŒæŒçºŒè¿½æ±‚æˆé•·èˆ‡å‰µæ–°......"></textarea>
      <div class="hint">ç›®å‰å­—æ•¸ï¼š<span id="charCount">0</span> / 120</div>
    </div>

    <button id="sendBtn" onclick="sendSummary()">âœ¨ ç™¼é€è‘£äº‹é•·ç¥ç¦åˆ°å¤§è¢å¹•</button>

    <div class="success-msg" id="successMsg">
      å·²æˆåŠŸç™¼é€è‡³å¤§è¢å¹•ã€‚<br/>
      è‹¥éœ€è¦èª¿æ•´å…§å®¹ï¼Œå¯å†æ¬¡è¼¸å…¥ä¸¦é€å‡ºæ›´æ–°ç‰ˆæœ¬ã€‚
    </div>

    <div class="warning-msg" id="warningMsg">
      ç›®å‰èˆ‡ä¸»æ©Ÿé€£ç·šä¸­æ–·ä¸­ï¼Œå¦‚æŒçºŒç„¡æ³•é€£ç·šï¼Œè«‹è¯ç¹«ç¾å ´å·¥ä½œäººå“¡ã€‚
    </div>

    <div class="status" id="status">æ­£åœ¨é€£ç·šè‡³ä¸»æ©Ÿ...</div>
  </div>

  <script>
    // === MQTT è¨­å®šï¼ˆéœ€èˆ‡é¡¯ç¤ºç«¯ä¸€è‡´ï¼‰ ===
    const broker = "broker.emqx.io";
    const port = 8084;
    const topic = "kgi_event_2025_live_demo_vtaco";
    const clientID = "chairman_" + new Date().getTime();

    const client = new Paho.MQTT.Client(broker, port, clientID);
    let isConnected = false;

    const statusEl = document.getElementById('status');
    const successEl = document.getElementById('successMsg');
    const warningEl = document.getElementById('warningMsg');
    const charCountEl = document.getElementById('charCount');
    const msgInput = document.getElementById('msg');
    
    /* â˜… é è¨­ï¼šç¸½ç¶“ç†ç¥ç¦å¥ï¼ˆå¯æ”¹ï¼‰ */
    const defaultMsg = "èšå‹¢æˆ ONE æˆå°±æ˜å¹´è¶…è¶Š";
    msgInput.value = defaultMsg;                 // ä¸€é€²é é¢å°±å¹«ä»–å¡«å¥½
    charCountEl.textContent = defaultMsg.length; // åˆå§‹åŒ–å­—æ•¸é¡¯ç¤º
    
    /* â˜… ä¹‹å¾Œå¦‚æœæœ‰ä¿®æ”¹ï¼Œä»ç„¶å³æ™‚æ›´æ–°å­—æ•¸ */
    msgInput.addEventListener('input', () => {
      charCountEl.textContent = msgInput.value.length;
    });


    client.onConnectionLost = function (responseObject) {
      console.log("é€£ç·šä¸­æ–·", responseObject);
      isConnected = false;
      statusEl.innerText = "ğŸ”´ é€£ç·šä¸­æ–·ï¼Œè«‹ç¨å€™æˆ–é‡æ–°æ•´ç†é é¢";
      warningEl.style.display = "block";
    };

    client.connect({
      useSSL: true,
      onSuccess: function () {
        console.log("é€£ç·šæˆåŠŸï¼ˆè‘£äº‹é•·ï¼‰");
        statusEl.innerText = "ğŸŸ¢ å·²é€£ç·šï¼Œå¯ä»¥éš¨æ™‚ç™¼é€ç¥ç¦";
        isConnected = true;
      },
      onFailure: function (e) {
        console.log("é€£ç·šå¤±æ•—", e);
        statusEl.innerText = "ğŸ”´ é€£ç·šå¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†æˆ–è«‹ç¾å ´äººå“¡å”åŠ©";
        warningEl.style.display = "block";
      }
    });

    function sendSummary() {
      const name = document.getElementById('name').value.trim();
      const msg = document.getElementById('msg').value.trim();
      const btn = document.getElementById('sendBtn');

      if (!isConnected) {
        alert("ç›®å‰å°šæœªæˆåŠŸé€£ç·šï¼Œè«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«ç¾å ´äººå“¡ã€‚");
        return;
      }
      if (!name || !msg) {
        alert("è«‹å¡«å¯«é¡¯ç¤ºåç¨±èˆ‡ç¥ç¦ã€‚");
        return;
      }

      // ç¢ºèªè¦–çª—ï¼Œé¿å…èª¤è§¸
      if (!confirm("ç¢ºå®šè¦å°‡é€™æ®µç¥ç¦é¡¯ç¤ºåœ¨å¤§è¢å¹•ä¸Šå—ï¼Ÿ")) {
        return;
      }

      const payload = JSON.stringify({
        role: "chairman",    // å›ºå®šï¼šè‘£äº‹é•·
        type: "summary",     // å›ºå®šï¼š
        office: "",          // å¯ç•™ç©ºï¼Œé¡¯ç¤ºç«¯æœƒä»¥ name ç‚ºä¸»
        name: name,
        msg: msg
      });

      try {
        const message = new Paho.MQTT.Message(payload);
        message.destinationName = topic;
        client.send(message);

        btn.disabled = true;
        btn.innerText = "å·²ç™¼é€ï¼Œç¨å€™ç‰‡åˆ»...";

        successEl.style.display = "block";
        warningEl.style.display = "none";

        setTimeout(() => {
          // è‹¥é‚„è¦å†ä¿®æ­£ã€å¯å†ç™¼ä¸€æ¬¡ï¼Œæ‰€ä»¥é‡æ–°é–‹å•ŸæŒ‰éˆ•
          btn.disabled = false;
          btn.innerText = "âœ¨ å†æ¬¡ç™¼é€æ›´æ–°ç‰ˆæœ¬";
        }, 4000);
      } catch (e) {
        console.error(e);
        alert("ç™¼é€å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–è«‹ç¾å ´äººå“¡å”åŠ©ã€‚");
      }
    }
  </script>
</body>
</html>
